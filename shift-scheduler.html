---
layout: default
title: ë³‘ì› ë‹¹ì§í‘œ ìƒì„±ê¸°
---

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            color: #34495e;
            margin-top: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .result-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .person-entry {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .person-entry h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 16px;
        }

        label {
            display: block;
            margin: 8px 0 4px 0;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 5px 0;
        }

        .checkbox-group label {
            display: inline-flex;
            align-items: center;
            margin: 0;
            font-weight: normal;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            margin: 5px;
        }

        button:hover {
            background: #2980b9;
        }

        button.secondary {
            background: #95a5a6;
        }

        button.secondary:hover {
            background: #7f8c8d;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover {
            background: #c0392b;
        }

        .button-group {
            text-align: center;
            margin: 20px 0;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-day {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background: white;
            min-height: 100px;
        }

        .calendar-day.week1 { background: #fff5f5; }
        .calendar-day.week2 { background: #f5f9ff; }
        .calendar-day.week3 { background: #f5fff5; }
        .calendar-day.week4 { background: #fffef5; }

        .day-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e0e0e0;
        }

        .day-number {
            font-size: 18px;
            color: #3498db;
        }

        .duty-assignment {
            margin: 5px 0;
            font-size: 14px;
        }

        .duty-primary {
            color: #e74c3c;
            font-weight: 600;
        }

        .duty-secondary {
            color: #3498db;
            font-weight: 500;
        }

        .stats {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #3498db;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .alert-error {
            background: #fee;
            border-left: 4px solid #e74c3c;
            color: #c0392b;
        }

        .alert-success {
            background: #efe;
            border-left: 4px solid #27ae60;
            color: #229954;
        }

        .alert-info {
            background: #eff;
            border-left: 4px solid #3498db;
            color: #2471a3;
        }

        .small-text {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
        }

        .add-person-form {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .preference-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }

        .badge-2nd-preferred {
            background: #d4edda;
            color: #155724;
        }

        .badge-2nd-limited {
            background: #fff3cd;
            color: #856404;
        }

        .badge-vacation {
            background: #f8d7da;
            color: #721c24;
        }

        .vacation-indicator {
            background: #f8d7da;
            color: #721c24;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            margin-top: 5px;
            font-weight: 600;
        }

        .vacation-form {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 3px solid #ffc107;
        }

        .vacation-list {
            margin-top: 10px;
        }

        .vacation-item {
            background: #fff;
            padding: 5px 10px;
            margin: 5px 0;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .day-range-input {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 5px;
            align-items: center;
        }

        .day-range-input input {
            width: 100%;
        }

        .calendar-day.editable {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calendar-day.editable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .calendar-day.manually-edited {
            border: 2px solid #f39c12;
            position: relative;
        }

        .manual-edit-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f39c12;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }

        .edit-mode {
            background: #fff9e6 !important;
            border: 2px solid #3498db !important;
        }

        .edit-controls {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .edit-controls select {
            width: 100%;
            margin: 5px 0;
            padding: 5px;
            font-size: 13px;
        }

        .edit-controls button {
            padding: 5px 10px;
            font-size: 12px;
            margin: 3px;
        }

        /* Calendar Preview Styles */
        .calendar-preview-section {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #3498db;
        }

        .calendar-preview-section h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .month-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .month-selector select {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .month-selector button {
            padding: 10px 20px;
        }

        .preview-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .preview-calendar-header {
            background: #2c3e50;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }

        .preview-calendar-header.sunday {
            background: #c0392b;
        }

        .preview-calendar-header.saturday {
            background: #2980b9;
        }

        .preview-day {
            background: white;
            padding: 8px;
            min-height: 70px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preview-day:hover:not(.empty) {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .preview-day.empty {
            background: #f5f5f5;
            cursor: default;
        }

        .preview-day.sunday {
            background: #fee;
            color: #c0392b;
        }

        .preview-day.saturday {
            background: #e8f4fd;
            color: #2980b9;
        }

        .preview-day.holiday {
            background: #ffeaa7;
            border: 2px solid #f39c12;
        }

        .preview-day.holiday.sunday {
            background: #fab1a0;
        }

        .preview-day.custom-holiday {
            background: #dfe6e9;
            border: 2px solid #636e72;
        }

        .preview-day .day-num {
            font-weight: bold;
            font-size: 16px;
        }

        .preview-day .holiday-name {
            font-size: 10px;
            color: #e74c3c;
            font-weight: 600;
            margin-top: 2px;
            line-height: 1.2;
        }

        .preview-day .weekday-indicator {
            font-size: 9px;
            color: #27ae60;
            margin-top: 2px;
        }

        .preview-day .duty-count {
            font-size: 9px;
            color: #9b59b6;
            margin-top: 2px;
        }

        .month-summary {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .month-summary-item {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
        }

        .month-summary-item.total-days {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
        }

        .month-summary-item.workdays {
            background: #d4edda;
            border-left: 4px solid #27ae60;
        }

        .month-summary-item.holidays {
            background: #ffeaa7;
            border-left: 4px solid #f39c12;
        }

        .month-summary-item.custom-holidays {
            background: #dfe6e9;
            border-left: 4px solid #636e72;
        }

        .month-summary-item .number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .month-summary-item .label {
            font-size: 11px;
            color: #7f8c8d;
        }

        /* Custom Holiday Management */
        .holiday-management {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #ddd;
        }

        .holiday-management h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 14px;
        }

        .add-holiday-form {
            display: grid;
            grid-template-columns: 1fr 2fr 80px 80px auto;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .add-holiday-form {
                grid-template-columns: 1fr 1fr;
            }
        }

        .add-holiday-form label {
            font-size: 12px;
            margin-bottom: 3px;
        }

        .add-holiday-form input,
        .add-holiday-form select {
            padding: 8px;
            font-size: 13px;
        }

        .holiday-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .holiday-item .holiday-info {
            flex: 1;
        }

        .holiday-item .holiday-date {
            font-weight: bold;
            color: #2c3e50;
        }

        .holiday-item .holiday-label {
            color: #7f8c8d;
            margin-left: 10px;
        }

        .holiday-item .holiday-duty {
            color: #9b59b6;
            font-size: 12px;
            margin-left: 10px;
        }

        /* Holiday Edit Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-content h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
        }

        .modal-content .form-group {
            margin-bottom: 15px;
        }

        .modal-content .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .modal-content .form-group input,
        .modal-content .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
        }
    </style>
</head>
<body>
    <h1>ğŸ¥ ë³‘ì› ë‹¹ì§í‘œ ìë™ ìƒì„±ê¸°</h1>

    <div class="container">
        <!-- Input Section -->
        <div class="input-section">
            <h2>ğŸ“‹ ì¸ì› ê´€ë¦¬</h2>

            <div class="add-person-form">
                <h3>ìƒˆ ì¸ì› ì¶”ê°€</h3>
                <label>ì´ë¦„</label>
                <input type="text" id="newPersonName" placeholder="ì´ë¦„ ì…ë ¥">

                <label>ë¶ˆê°€ëŠ¥í•œ ìš”ì¼ (ë‹¹ì§)</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" value="ì›”" class="new-unavailable-day"> ì›”</label>
                    <label><input type="checkbox" value="í™”" class="new-unavailable-day"> í™”</label>
                    <label><input type="checkbox" value="ìˆ˜" class="new-unavailable-day"> ìˆ˜</label>
                    <label><input type="checkbox" value="ëª©" class="new-unavailable-day"> ëª©</label>
                    <label><input type="checkbox" value="ê¸ˆ" class="new-unavailable-day"> ê¸ˆ</label>
                </div>

                <label>ëŒ€ì²´ ê°€ëŠ¥ ìš”ì¼ (2nd dutyë¡œ ê°€ëŠ¥)</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" value="ì›”" class="new-alternative-day"> ì›”</label>
                    <label><input type="checkbox" value="í™”" class="new-alternative-day"> í™”</label>
                    <label><input type="checkbox" value="ìˆ˜" class="new-alternative-day"> ìˆ˜</label>
                    <label><input type="checkbox" value="ëª©" class="new-alternative-day"> ëª©</label>
                    <label><input type="checkbox" value="ê¸ˆ" class="new-alternative-day"> ê¸ˆ</label>
                </div>

                <label>ìµœëŒ€ ë‹¹ì§ íšŸìˆ˜</label>
                <input type="number" id="newPersonMaxDuties" value="5" min="0" max="20">

                <label>2nd Duty ì„ í˜¸ë„</label>
                <select id="newPersonSecondDutyPref">
                    <option value="normal">ì¼ë°˜</option>
                    <option value="preferred">ì„ í˜¸ (ë¬´ì œí•œ)</option>
                    <option value="limited">ì œí•œì  (1íšŒë§Œ)</option>
                    <option value="2nd-only">2nd dutyë§Œ</option>
                </select>

                <div class="button-group">
                    <button onclick="addPerson()">â• ì¸ì› ì¶”ê°€</button>
                </div>
            </div>

            <div id="personList"></div>

            <div class="button-group">
                <button onclick="loadSampleData()">ğŸ“ ì˜ˆì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button onclick="clearAllData()" class="danger">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
            </div>
        </div>

        <!-- Result Section -->
        <div class="result-section">
            <h2>ğŸ“… ë‹¹ì§í‘œ</h2>

            <!-- Calendar Preview Section -->
            <div class="calendar-preview-section">
                <h3>ğŸ“† ì›” ì„ íƒ ë° ìº˜ë¦°ë” ë¯¸ë¦¬ë³´ê¸°</h3>
                <div class="month-selector">
                    <select id="selectYear"></select>
                    <span>ë…„</span>
                    <select id="selectMonth">
                        <option value="1">1ì›”</option>
                        <option value="2">2ì›”</option>
                        <option value="3">3ì›”</option>
                        <option value="4">4ì›”</option>
                        <option value="5">5ì›”</option>
                        <option value="6">6ì›”</option>
                        <option value="7">7ì›”</option>
                        <option value="8">8ì›”</option>
                        <option value="9">9ì›”</option>
                        <option value="10">10ì›”</option>
                        <option value="11">11ì›”</option>
                        <option value="12">12ì›”</option>
                    </select>
                    <button onclick="showCalendarPreview()">ğŸ“… ë¯¸ë¦¬ë³´ê¸°</button>
                </div>
                <div id="calendarPreview"></div>

                <!-- Custom Holiday Management -->
                <div class="holiday-management" id="holidayManagement" style="display: none;">
                    <h4>ğŸ—“ï¸ íœ´ì¼ ê´€ë¦¬ (ë‚ ì§œ í´ë¦­í•˜ì—¬ ì¶”ê°€/í¸ì§‘)</h4>
                    <div class="add-holiday-form">
                        <div>
                            <label>ë‚ ì§œ</label>
                            <input type="number" id="customHolidayDay" min="1" max="31" placeholder="ì¼">
                        </div>
                        <div>
                            <label>íœ´ì¼ëª…</label>
                            <input type="text" id="customHolidayName" placeholder="íœ´ì¼ ì´ë¦„">
                        </div>
                        <div>
                            <label>ë‹¹ì§</label>
                            <input type="number" id="customHolidayPrimary" min="0" max="10" value="1">
                        </div>
                        <div>
                            <label>2nd</label>
                            <input type="number" id="customHolidaySecondary" min="0" max="10" value="1">
                        </div>
                        <div>
                            <button onclick="addCustomHoliday()" style="padding: 8px 15px;">ì¶”ê°€</button>
                        </div>
                    </div>
                    <div class="holiday-list" id="customHolidayList"></div>
                </div>
            </div>

            <div class="button-group">
                <button onclick="generateSchedule()">ğŸ¯ ë‹¹ì§í‘œ ìƒì„±</button>
                <button onclick="exportSchedule()" class="secondary">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
            </div>

            <div class="alert alert-info" style="font-size: 13px;">
                ğŸ’¡ <strong>íŒ:</strong> ìº˜ë¦°ë”ì—ì„œ ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ë‚ ì§œë¥¼ íœ´ì¼ë¡œ ì§€ì •í•˜ê³  ë‹¹ì§ ì¸ì› ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>

            <div id="messages"></div>
            <div id="calendar"></div>
            <div id="statistics"></div>
        </div>
    </div>

    <!-- Holiday Edit Modal -->
    <div class="modal-overlay" id="holidayModal">
        <div class="modal-content">
            <h3>ğŸ“… <span id="modalDate"></span> ì„¤ì •</h3>
            <div class="form-group">
                <label>íœ´ì¼ëª… (ë¹ˆì¹¸ì´ë©´ í‰ì¼)</label>
                <input type="text" id="modalHolidayName" placeholder="íœ´ì¼ ì´ë¦„ (ì˜ˆ: ëŒ€ì²´íœ´ì¼)">
            </div>
            <div class="form-group">
                <label>ë‹¹ì§ ì¸ì› ìˆ˜</label>
                <input type="number" id="modalPrimaryCount" min="0" max="10" value="1">
            </div>
            <div class="form-group">
                <label>2nd Duty ì¸ì› ìˆ˜</label>
                <input type="number" id="modalSecondaryCount" min="0" max="10" value="1">
            </div>
            <div class="modal-buttons">
                <button onclick="saveHolidaySettings()" style="background: #27ae60;">ì €ì¥</button>
                <button onclick="removeHolidaySettings()" class="danger">ì‚­ì œ</button>
                <button onclick="closeModal()" class="secondary">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // Global data
        let people = [];
        let schedule = null;
        let selectedYear = new Date().getFullYear();
        let selectedMonth = new Date().getMonth() + 1;
        let workdaysInMonth = [];
        let customHolidays = {}; // { 'YYYY-MM-DD': { name: '', primaryCount: 1, secondaryCount: 1 } }
        let currentEditingDate = null;

        const DAYS_OF_WEEK = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
        const DAYS_OF_WEEK_FULL = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        let TOTAL_DAYS = 20;
        let WEEKS = 4;

        // ëŒ€í•œë¯¼êµ­ ê³µíœ´ì¼ ë°ì´í„°
        const FIXED_HOLIDAYS = {
            '01-01': 'ì‹ ì •',
            '03-01': 'ì‚¼ì¼ì ˆ',
            '05-05': 'ì–´ë¦°ì´ë‚ ',
            '06-06': 'í˜„ì¶©ì¼',
            '08-15': 'ê´‘ë³µì ˆ',
            '10-03': 'ê°œì²œì ˆ',
            '10-09': 'í•œê¸€ë‚ ',
            '12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
        };

        // ìŒë ¥ ê¸°ë°˜ ê³µíœ´ì¼ (2024~2030ë…„)
        const LUNAR_HOLIDAYS = {
            2024: {
                '02-09': 'ì„¤ë‚  ì—°íœ´', '02-10': 'ì„¤ë‚ ', '02-11': 'ì„¤ë‚  ì—°íœ´', '02-12': 'ëŒ€ì²´ê³µíœ´ì¼',
                '05-15': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '09-16': 'ì¶”ì„ ì—°íœ´', '09-17': 'ì¶”ì„', '09-18': 'ì¶”ì„ ì—°íœ´'
            },
            2025: {
                '01-28': 'ì„¤ë‚  ì—°íœ´', '01-29': 'ì„¤ë‚ ', '01-30': 'ì„¤ë‚  ì—°íœ´',
                '05-05': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '10-05': 'ì¶”ì„ ì—°íœ´', '10-06': 'ì¶”ì„', '10-07': 'ì¶”ì„ ì—°íœ´', '10-08': 'ëŒ€ì²´ê³µíœ´ì¼'
            },
            2026: {
                '02-16': 'ì„¤ë‚  ì—°íœ´', '02-17': 'ì„¤ë‚ ', '02-18': 'ì„¤ë‚  ì—°íœ´',
                '05-24': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '09-24': 'ì¶”ì„ ì—°íœ´', '09-25': 'ì¶”ì„', '09-26': 'ì¶”ì„ ì—°íœ´'
            },
            2027: {
                '02-06': 'ì„¤ë‚  ì—°íœ´', '02-07': 'ì„¤ë‚ ', '02-08': 'ì„¤ë‚  ì—°íœ´', '02-09': 'ëŒ€ì²´ê³µíœ´ì¼',
                '05-13': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '09-14': 'ì¶”ì„ ì—°íœ´', '09-15': 'ì¶”ì„', '09-16': 'ì¶”ì„ ì—°íœ´'
            },
            2028: {
                '01-26': 'ì„¤ë‚  ì—°íœ´', '01-27': 'ì„¤ë‚ ', '01-28': 'ì„¤ë‚  ì—°íœ´',
                '05-02': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '10-02': 'ì¶”ì„ ì—°íœ´', '10-03': 'ì¶”ì„', '10-04': 'ì¶”ì„ ì—°íœ´'
            },
            2029: {
                '02-12': 'ì„¤ë‚  ì—°íœ´', '02-13': 'ì„¤ë‚ ', '02-14': 'ì„¤ë‚  ì—°íœ´',
                '05-20': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '09-21': 'ì¶”ì„ ì—°íœ´', '09-22': 'ì¶”ì„', '09-23': 'ì¶”ì„ ì—°íœ´'
            },
            2030: {
                '02-02': 'ì„¤ë‚  ì—°íœ´', '02-03': 'ì„¤ë‚ ', '02-04': 'ì„¤ë‚  ì—°íœ´',
                '05-09': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '09-11': 'ì¶”ì„ ì—°íœ´', '09-12': 'ì¶”ì„', '09-13': 'ì¶”ì„ ì—°íœ´'
            }
        };

        // ê³µíœ´ì¼ ì¡°íšŒ í•¨ìˆ˜
        function getHoliday(year, month, day) {
            const monthStr = String(month).padStart(2, '0');
            const dayStr = String(day).padStart(2, '0');
            const dateKey = `${monthStr}-${dayStr}`;
            const fullDateKey = `${year}-${dateKey}`;

            // ì‚¬ìš©ì ì •ì˜ íœ´ì¼ í™•ì¸
            if (customHolidays[fullDateKey]) {
                return { name: customHolidays[fullDateKey].name, isCustom: true };
            }

            // ì–‘ë ¥ ê³ ì • ê³µíœ´ì¼
            if (FIXED_HOLIDAYS[dateKey]) {
                return { name: FIXED_HOLIDAYS[dateKey], isCustom: false };
            }

            // ìŒë ¥ ê¸°ë°˜ ê³µíœ´ì¼
            if (LUNAR_HOLIDAYS[year] && LUNAR_HOLIDAYS[year][dateKey]) {
                return { name: LUNAR_HOLIDAYS[year][dateKey], isCustom: false };
            }

            return null;
        }

        // ë‚ ì§œë³„ ë‹¹ì§ ì¸ì› ìˆ˜ ì¡°íšŒ
        function getDutyCount(year, month, day) {
            const fullDateKey = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            if (customHolidays[fullDateKey]) {
                return {
                    primary: customHolidays[fullDateKey].primaryCount,
                    secondary: customHolidays[fullDateKey].secondaryCount
                };
            }
            return { primary: 1, secondary: 1 }; // ê¸°ë³¸ê°’
        }

        // ë…„ë„ ì„ íƒ ì´ˆê¸°í™”
        function initYearSelector() {
            const yearSelect = document.getElementById('selectYear');
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';

            for (let year = currentYear - 1; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }

            document.getElementById('selectMonth').value = new Date().getMonth() + 1;
        }

        // ìº˜ë¦°ë” ë¯¸ë¦¬ë³´ê¸°
        function showCalendarPreview() {
            selectedYear = parseInt(document.getElementById('selectYear').value);
            selectedMonth = parseInt(document.getElementById('selectMonth').value);
            renderCalendarPreview(selectedYear, selectedMonth);
            document.getElementById('holidayManagement').style.display = 'block';
            renderCustomHolidayList();
        }

        // ìº˜ë¦°ë” í”„ë¦¬ë·° ë Œë”ë§
        function renderCalendarPreview(year, month) {
            const previewDiv = document.getElementById('calendarPreview');
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay();

            let html = '<div class="preview-calendar">';

            // ìš”ì¼ í—¤ë”
            DAYS_OF_WEEK_FULL.forEach((day, index) => {
                let headerClass = 'preview-calendar-header';
                if (index === 0) headerClass += ' sunday';
                if (index === 6) headerClass += ' saturday';
                html += `<div class="${headerClass}">${day}</div>`;
            });

            // ë¹ˆ ì¹¸ (ì›” ì‹œì‘ ì „)
            for (let i = 0; i < startDayOfWeek; i++) {
                html += '<div class="preview-day empty"></div>';
            }

            // ë‚ ì§œ ì±„ìš°ê¸°
            let workdayIndex = 0;
            let publicHolidayCount = 0;
            let customHolidayCount = 0;
            workdaysInMonth = [];

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayOfWeek = date.getDay();
                const holiday = getHoliday(year, month, day);
                const dutyCount = getDutyCount(year, month, day);

                let dayClass = 'preview-day';
                if (dayOfWeek === 0) dayClass += ' sunday';
                if (dayOfWeek === 6) dayClass += ' saturday';

                if (holiday) {
                    if (holiday.isCustom) {
                        dayClass += ' custom-holiday';
                        customHolidayCount++;
                    } else {
                        dayClass += ' holiday';
                        publicHolidayCount++;
                    }
                }

                let dayContent = `<div class="day-num">${day}</div>`;
                if (holiday && holiday.name) {
                    dayContent += `<div class="holiday-name">${holiday.name}</div>`;
                }

                // í‰ì¼ ë˜ëŠ” ë‹¹ì§ ìˆëŠ” íœ´ì¼
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const hasHoliday = holiday !== null;
                const hasDuty = dutyCount.primary > 0 || dutyCount.secondary > 0;

                if (!isWeekend && (!hasHoliday || hasDuty)) {
                    workdayIndex++;
                    workdaysInMonth.push({
                        day: day,
                        dayOfWeek: DAYS_OF_WEEK[dayOfWeek - 1],
                        date: date,
                        isHoliday: hasHoliday,
                        holidayName: holiday ? holiday.name : null,
                        primaryCount: dutyCount.primary,
                        secondaryCount: dutyCount.secondary
                    });
                    if (!hasHoliday) {
                        dayContent += `<div class="weekday-indicator">ë‹¹ì§ ${workdayIndex}ì¼ì°¨</div>`;
                    }
                }

                if (hasDuty && (dutyCount.primary !== 1 || dutyCount.secondary !== 1)) {
                    dayContent += `<div class="duty-count">ë‹¹ì§${dutyCount.primary}/2nd${dutyCount.secondary}</div>`;
                }

                const fullDateKey = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                html += `<div class="${dayClass}" onclick="openDayModal('${fullDateKey}', ${day})">${dayContent}</div>`;
            }

            // ë¹ˆ ì¹¸ (ì›” ë)
            const totalCells = startDayOfWeek + daysInMonth;
            const remainingCells = 7 - (totalCells % 7);
            if (remainingCells < 7) {
                for (let i = 0; i < remainingCells; i++) {
                    html += '<div class="preview-day empty"></div>';
                }
            }

            html += '</div>';

            // ìš”ì•½ ì •ë³´
            const workdays = workdaysInMonth.length;
            html += `
                <div class="month-summary">
                    <div class="month-summary-item total-days">
                        <div class="number">${daysInMonth}</div>
                        <div class="label">ì´ ì¼ìˆ˜</div>
                    </div>
                    <div class="month-summary-item workdays">
                        <div class="number">${workdays}</div>
                        <div class="label">ê·¼ë¬´ì¼</div>
                    </div>
                    <div class="month-summary-item holidays">
                        <div class="number">${publicHolidayCount}</div>
                        <div class="label">ê³µíœ´ì¼</div>
                    </div>
                    <div class="month-summary-item custom-holidays">
                        <div class="number">${customHolidayCount}</div>
                        <div class="label">ì‚¬ìš©ì íœ´ì¼</div>
                    </div>
                </div>
                <div class="alert alert-info" style="margin-top: 15px;">
                    ğŸ“Œ <strong>${year}ë…„ ${month}ì›”</strong>: ê·¼ë¬´ì¼ <strong>${workdays}ì¼</strong> |
                    ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ íœ´ì¼ ì§€ì • ë° ë‹¹ì§ ì¸ì› ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.
                </div>
            `;

            TOTAL_DAYS = workdays;
            WEEKS = Math.ceil(workdays / 5);
            previewDiv.innerHTML = html;
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openDayModal(dateKey, day) {
            currentEditingDate = dateKey;
            const [year, month] = dateKey.split('-');
            document.getElementById('modalDate').textContent = `${year}ë…„ ${parseInt(month)}ì›” ${day}ì¼`;

            const existing = customHolidays[dateKey];
            if (existing) {
                document.getElementById('modalHolidayName').value = existing.name || '';
                document.getElementById('modalPrimaryCount').value = existing.primaryCount;
                document.getElementById('modalSecondaryCount').value = existing.secondaryCount;
            } else {
                document.getElementById('modalHolidayName').value = '';
                document.getElementById('modalPrimaryCount').value = 1;
                document.getElementById('modalSecondaryCount').value = 1;
            }

            document.getElementById('holidayModal').classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('holidayModal').classList.remove('active');
            currentEditingDate = null;
        }

        // íœ´ì¼ ì„¤ì • ì €ì¥
        function saveHolidaySettings() {
            if (!currentEditingDate) return;

            const name = document.getElementById('modalHolidayName').value.trim();
            const primaryCount = parseInt(document.getElementById('modalPrimaryCount').value) || 1;
            const secondaryCount = parseInt(document.getElementById('modalSecondaryCount').value) || 1;

            customHolidays[currentEditingDate] = {
                name: name,
                primaryCount: primaryCount,
                secondaryCount: secondaryCount
            };

            closeModal();
            renderCalendarPreview(selectedYear, selectedMonth);
            renderCustomHolidayList();
            showMessage('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // íœ´ì¼ ì„¤ì • ì‚­ì œ
        function removeHolidaySettings() {
            if (!currentEditingDate) return;

            if (customHolidays[currentEditingDate]) {
                delete customHolidays[currentEditingDate];
                closeModal();
                renderCalendarPreview(selectedYear, selectedMonth);
                renderCustomHolidayList();
                showMessage('ì„¤ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            } else {
                closeModal();
            }
        }

        // ì‚¬ìš©ì ì •ì˜ íœ´ì¼ ì¶”ê°€ (í¼ì—ì„œ)
        function addCustomHoliday() {
            const day = parseInt(document.getElementById('customHolidayDay').value);
            const name = document.getElementById('customHolidayName').value.trim();
            const primaryCount = parseInt(document.getElementById('customHolidayPrimary').value) || 1;
            const secondaryCount = parseInt(document.getElementById('customHolidaySecondary').value) || 1;

            if (!day || day < 1 || day > 31) {
                showMessage('ì˜¬ë°”ë¥¸ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const dateKey = `${selectedYear}-${String(selectedMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            customHolidays[dateKey] = { name, primaryCount, secondaryCount };

            // í¼ ì´ˆê¸°í™”
            document.getElementById('customHolidayDay').value = '';
            document.getElementById('customHolidayName').value = '';
            document.getElementById('customHolidayPrimary').value = 1;
            document.getElementById('customHolidaySecondary').value = 1;

            renderCalendarPreview(selectedYear, selectedMonth);
            renderCustomHolidayList();
            showMessage('íœ´ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì‚¬ìš©ì ì •ì˜ íœ´ì¼ ëª©ë¡ ë Œë”ë§
        function renderCustomHolidayList() {
            const listDiv = document.getElementById('customHolidayList');
            const monthKey = `${selectedYear}-${String(selectedMonth).padStart(2, '0')}`;
            const monthHolidays = Object.entries(customHolidays)
                .filter(([key]) => key.startsWith(monthKey))
                .sort(([a], [b]) => a.localeCompare(b));

            if (monthHolidays.length === 0) {
                listDiv.innerHTML = '<p class="small-text">ì„¤ì •ëœ ì‚¬ìš©ì ì •ì˜ íœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let html = '';
            monthHolidays.forEach(([dateKey, holiday]) => {
                const day = parseInt(dateKey.split('-')[2]);
                html += `
                    <div class="holiday-item">
                        <div class="holiday-info">
                            <span class="holiday-date">${selectedMonth}ì›” ${day}ì¼</span>
                            <span class="holiday-label">${holiday.name || '(í‰ì¼ ì„¤ì •)'}</span>
                            <span class="holiday-duty">ë‹¹ì§ ${holiday.primaryCount}ëª… / 2nd ${holiday.secondaryCount}ëª…</span>
                        </div>
                        <button onclick="removeCustomHoliday('${dateKey}')" class="danger" style="padding: 3px 8px; font-size: 12px;">ì‚­ì œ</button>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
        }

        // ì‚¬ìš©ì ì •ì˜ íœ´ì¼ ì‚­ì œ
        function removeCustomHoliday(dateKey) {
            if (confirm('ì´ ì„¤ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                delete customHolidays[dateKey];
                renderCalendarPreview(selectedYear, selectedMonth);
                renderCustomHolidayList();
                showMessage('ì„¤ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // Person class
        class Person {
            constructor(name, unavailableDays, alternativeDays, maxDuties, secondDutyPref, vacations, weeklyRestrictions) {
                this.name = name;
                this.unavailableDays = unavailableDays || [];
                this.alternativeDays = alternativeDays || [];
                this.maxDuties = maxDuties || 5;
                this.secondDutyPref = secondDutyPref || 'normal'; // 'normal', 'preferred', 'limited'
                this.vacations = vacations || []; // Array of {start, end} objects
                this.weeklyRestrictions = weeklyRestrictions || {}; // {weekNum: {unavailable: [], alternative: []}}
                this.primaryCount = 0;
                this.secondaryCount = 0;
            }

            isOnVacation(dayNumber) {
                return this.vacations.some(v => dayNumber >= v.start && dayNumber <= v.end);
            }

            canDoPrimaryDuty(dayOfWeek, dayNumber, weekNumber) {
                // 2nd duty only staff cannot do primary duty
                if (this.secondDutyPref === '2nd-only') return false;

                if (this.isOnVacation(dayNumber)) return false;

                // Check general unavailable days (applies to all weeks)
                if (this.unavailableDays.includes(dayOfWeek)) return false;

                // Check week-specific restrictions
                if (weekNumber && this.weeklyRestrictions[weekNumber]) {
                    const weekRestriction = this.weeklyRestrictions[weekNumber];
                    if (weekRestriction.unavailable && weekRestriction.unavailable.includes(dayOfWeek)) {
                        return false;
                    }
                }

                return true;
            }

            canDoSecondaryDuty(dayOfWeek, dayNumber, weekNumber) {
                if (this.isOnVacation(dayNumber)) return false;

                // Check week-specific restrictions first
                if (weekNumber && this.weeklyRestrictions[weekNumber]) {
                    const weekRestriction = this.weeklyRestrictions[weekNumber];
                    if (weekRestriction.unavailable && weekRestriction.unavailable.includes(dayOfWeek)) {
                        // Check if this day is in alternative list for this week
                        return weekRestriction.alternative && weekRestriction.alternative.includes(dayOfWeek);
                    }
                }

                // Check general unavailable days
                if (this.unavailableDays.includes(dayOfWeek)) {
                    return this.alternativeDays.includes(dayOfWeek);
                }

                return true;
            }

            getTotalDuties() {
                return this.primaryCount + this.secondaryCount;
            }

            canTakeMoreDuties() {
                if (this.secondDutyPref === 'preferred') {
                    return true; // Unlimited for 2nd duty preferred
                }
                if (this.secondDutyPref === '2nd-only') {
                    return this.secondaryCount < this.maxDuties; // Only 2nd duty counts for 2nd-only staff
                }
                if (this.secondDutyPref === 'limited' && this.secondaryCount >= 1) {
                    return this.primaryCount < this.maxDuties;
                }
                return this.getTotalDuties() < this.maxDuties;
            }

            addVacation(start, end) {
                this.vacations.push({ start, end });
            }

            removeVacation(index) {
                this.vacations.splice(index, 1);
            }

            addWeeklyRestriction(weekNum, unavailableDays, alternativeDays) {
                this.weeklyRestrictions[weekNum] = {
                    unavailable: unavailableDays || [],
                    alternative: alternativeDays || []
                };
            }

            removeWeeklyRestriction(weekNum) {
                delete this.weeklyRestrictions[weekNum];
            }
        }

        // Load sample data
        function loadSampleData() {
            // Create person with weekly restriction example
            const kimNayoung = new Person('ê¹€ë‚˜ì˜', ['í™”', 'ëª©', 'ê¸ˆ'], [], 3, 'normal', [], {});
            kimNayoung.addWeeklyRestriction(1, ['ì›”', 'ìˆ˜'], []);  // 1ì£¼ì°¨: ì›”, ìˆ˜ ë¶ˆê°€
            kimNayoung.addWeeklyRestriction(2, ['ëª©', 'ê¸ˆ'], ['ëª©']);  // 2ì£¼ì°¨: ëª©, ê¸ˆ ë¶ˆê°€ (ëª©ìš”ì¼ì€ 2nd ê°€ëŠ¥)

            people = [
                kimNayoung,
                new Person('ì´í˜„ê·œ', [], [], 20, 'preferred', [], {}),
                new Person('ì´ì •ìˆ˜', ['ìˆ˜', 'ëª©'], ['ìˆ˜'], 5, 'normal', [], {}),
                new Person('ìœ ì˜ì² ', ['ìˆ˜', 'ëª©', 'ê¸ˆ'], [], 3, 'normal', [], {}),
                new Person('ì„œì§€ìš°', ['ì›”', 'í™”'], ['ì›”'], 5, 'normal', [], {}),
                new Person('ì´ë¯¼ì •', ['í™”', 'ìˆ˜'], ['í™”'], 5, 'normal', [], {}),
                new Person('ê³µí¬ì •', ['ì›”', 'í™”'], ['ì›”'], 5, 'normal', [], {}),
                new Person('ë¬¸ì§€ì• ', ['ëª©', 'ê¸ˆ'], ['ëª©'], 5, 'normal', [], {}),
                new Person('ì „ë³‘ë‚¨', ['ìˆ˜', 'ëª©'], ['ìˆ˜'], 5, 'normal', [], {}),
                new Person('ë…¸í˜„ì •', ['í™”', 'ìˆ˜'], ['í™”'], 5, 'normal', [], {}),
                new Person('ë°±ì§€ì›', [], [], 5, 'limited', [], {}),
                new Person('ë°•ìˆ˜ì •', ['ê¸ˆ', 'ì›”'], ['ê¸ˆ'], 5, 'normal', [{start: 5, end: 12}], {})
            ];
            renderPersonList();
            showMessage('ì˜ˆì‹œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. (ê¹€ë‚˜ì˜: 1ì£¼ì°¨ ì›”/ìˆ˜, 2ì£¼ì°¨ ëª©/ê¸ˆ ë¶ˆê°€)', 'success');
        }

        // Add person
        function addPerson() {
            const name = document.getElementById('newPersonName').value.trim();
            if (!name) {
                showMessage('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const unavailableDays = Array.from(document.querySelectorAll('.new-unavailable-day:checked'))
                .map(cb => cb.value);
            const alternativeDays = Array.from(document.querySelectorAll('.new-alternative-day:checked'))
                .map(cb => cb.value);
            const maxDuties = parseInt(document.getElementById('newPersonMaxDuties').value) || 5;
            const secondDutyPref = document.getElementById('newPersonSecondDutyPref').value;

            people.push(new Person(name, unavailableDays, alternativeDays, maxDuties, secondDutyPref));

            // Clear form
            document.getElementById('newPersonName').value = '';
            document.querySelectorAll('.new-unavailable-day').forEach(cb => cb.checked = false);
            document.querySelectorAll('.new-alternative-day').forEach(cb => cb.checked = false);
            document.getElementById('newPersonMaxDuties').value = 5;
            document.getElementById('newPersonSecondDutyPref').value = 'normal';

            renderPersonList();
            showMessage(`${name} ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // Remove person
        function removePerson(index) {
            const person = people[index];
            if (confirm(`${person.name} ë‹˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                people.splice(index, 1);
                renderPersonList();
                showMessage('ì¸ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('ëª¨ë“  ì¸ì› ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                people = [];
                schedule = null;
                renderPersonList();
                document.getElementById('calendar').innerHTML = '';
                document.getElementById('statistics').innerHTML = '';
                showMessage('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // Render person list
        function renderPersonList() {
            const listDiv = document.getElementById('personList');
            if (people.length === 0) {
                listDiv.innerHTML = '<p class="small-text">ë“±ë¡ëœ ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¸ì›ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì˜ˆì‹œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</p>';
                return;
            }

            let html = '<h3>ë“±ë¡ëœ ì¸ì› (' + people.length + 'ëª…)</h3>';
            people.forEach((person, index) => {
                let badge = '';
                if (person.secondDutyPref === 'preferred') {
                    badge = '<span class="preference-badge badge-2nd-preferred">2nd ì„ í˜¸</span>';
                } else if (person.secondDutyPref === 'limited') {
                    badge = '<span class="preference-badge badge-2nd-limited">2nd 1íšŒë§Œ</span>';
                } else if (person.secondDutyPref === '2nd-only') {
                    badge = '<span class="preference-badge badge-vacation">2ndë§Œ</span>';
                }

                let vacationHTML = '';
                if (person.vacations && person.vacations.length > 0) {
                    vacationHTML = '<div class="vacation-list">';
                    person.vacations.forEach((vacation, vIdx) => {
                        vacationHTML += `
                            <div class="vacation-item">
                                <span>ğŸ–ï¸ Day ${vacation.start} ~ ${vacation.end}</span>
                                <button onclick="removeVacation(${index}, ${vIdx})" class="danger" style="padding: 3px 8px; font-size: 12px;">ì‚­ì œ</button>
                            </div>
                        `;
                    });
                    vacationHTML += '</div>';
                }

                // Weekly restrictions display and form
                let weeklyHTML = '';
                if (person.weeklyRestrictions && Object.keys(person.weeklyRestrictions).length > 0) {
                    weeklyHTML = '<div class="vacation-list" style="margin-top: 10px;">';
                    Object.keys(person.weeklyRestrictions).sort().forEach(weekNum => {
                        const restriction = person.weeklyRestrictions[weekNum];
                        const unavailText = restriction.unavailable && restriction.unavailable.length > 0
                            ? restriction.unavailable.join(', ') : 'ì—†ìŒ';
                        const altText = restriction.alternative && restriction.alternative.length > 0
                            ? `, 2nd ê°€ëŠ¥: ${restriction.alternative.join(', ')}` : '';
                        weeklyHTML += `
                            <div class="vacation-item">
                                <span>ğŸ“… ${weekNum}ì£¼ì°¨: ${unavailText}${altText}</span>
                                <button onclick="removeWeeklyRestriction(${index}, ${weekNum})" class="danger" style="padding: 3px 8px; font-size: 12px;">ì‚­ì œ</button>
                            </div>
                        `;
                    });
                    weeklyHTML += '</div>';
                }

                html += `
                    <div class="person-entry">
                        <h3>${person.name}${badge}</h3>
                        <p class="small-text">
                            <strong>ë‹¹ì§ ë¶ˆê°€ (ì „ì²´):</strong> ${person.unavailableDays.join(', ') || 'ì—†ìŒ'}<br>
                            <strong>2nd ê°€ëŠ¥ (ì „ì²´):</strong> ${person.alternativeDays.join(', ') || 'í•´ë‹¹ì—†ìŒ'}<br>
                            <strong>ìµœëŒ€ íšŸìˆ˜:</strong> ${person.maxDuties}íšŒ
                        </p>
                        ${weeklyHTML}
                        ${vacationHTML}

                        <div class="vacation-form" style="background: #e8f4f8;">
                            <label style="font-size: 13px; margin-bottom: 5px;">ì£¼ë³„ ì œì•½ ì¶”ê°€</label>
                            <div style="display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: start;">
                                <div>
                                    <label style="font-size: 12px;">ì£¼ì°¨</label>
                                    <select id="weekNum_${index}" style="width: 60px; padding: 5px; font-size: 13px;">
                                        <option value="1">1ì£¼</option>
                                        <option value="2">2ì£¼</option>
                                        <option value="3">3ì£¼</option>
                                        <option value="4">4ì£¼</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size: 12px;">ë¶ˆê°€ëŠ¥í•œ ìš”ì¼</label>
                                    <div class="checkbox-group" style="margin-bottom: 5px;">
                                        <label><input type="checkbox" value="ì›”" class="week-unavailable-${index}"> ì›”</label>
                                        <label><input type="checkbox" value="í™”" class="week-unavailable-${index}"> í™”</label>
                                        <label><input type="checkbox" value="ìˆ˜" class="week-unavailable-${index}"> ìˆ˜</label>
                                        <label><input type="checkbox" value="ëª©" class="week-unavailable-${index}"> ëª©</label>
                                        <label><input type="checkbox" value="ê¸ˆ" class="week-unavailable-${index}"> ê¸ˆ</label>
                                    </div>
                                    <label style="font-size: 12px;">2nd duty ê°€ëŠ¥</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" value="ì›”" class="week-alternative-${index}"> ì›”</label>
                                        <label><input type="checkbox" value="í™”" class="week-alternative-${index}"> í™”</label>
                                        <label><input type="checkbox" value="ìˆ˜" class="week-alternative-${index}"> ìˆ˜</label>
                                        <label><input type="checkbox" value="ëª©" class="week-alternative-${index}"> ëª©</label>
                                        <label><input type="checkbox" value="ê¸ˆ" class="week-alternative-${index}"> ê¸ˆ</label>
                                    </div>
                                </div>
                            </div>
                            <button onclick="addWeeklyRestriction(${index})" style="padding: 6px 12px; font-size: 13px; margin-top: 5px;">ì£¼ë³„ ì œì•½ ì¶”ê°€</button>
                        </div>

                        <div class="vacation-form">
                            <label style="font-size: 13px; margin-bottom: 5px;">íœ´ê°€ ì¶”ê°€</label>
                            <div class="day-range-input">
                                <input type="number" id="vacStart_${index}" min="1" max="20" placeholder="ì‹œì‘ì¼">
                                <span>~</span>
                                <input type="number" id="vacEnd_${index}" min="1" max="20" placeholder="ì¢…ë£Œì¼">
                            </div>
                            <button onclick="addVacation(${index})" style="padding: 6px 12px; font-size: 13px; margin-top: 5px;">íœ´ê°€ ì¶”ê°€</button>
                        </div>
                        <button onclick="removePerson(${index})" class="danger" style="padding: 6px 12px; font-size: 14px; margin-top: 10px;">ì¸ì› ì‚­ì œ</button>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
        }

        // Add weekly restriction
        function addWeeklyRestriction(personIndex) {
            const weekNum = parseInt(document.getElementById(`weekNum_${personIndex}`).value);
            const unavailableDays = Array.from(document.querySelectorAll(`.week-unavailable-${personIndex}:checked`))
                .map(cb => cb.value);
            const alternativeDays = Array.from(document.querySelectorAll(`.week-alternative-${personIndex}:checked`))
                .map(cb => cb.value);

            if (unavailableDays.length === 0) {
                showMessage('ë¶ˆê°€ëŠ¥í•œ ìš”ì¼ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            people[personIndex].addWeeklyRestriction(weekNum, unavailableDays, alternativeDays);
            renderPersonList();
            showMessage(`${people[personIndex].name}ì˜ ${weekNum}ì£¼ì°¨ ì œì•½ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // Remove weekly restriction
        function removeWeeklyRestriction(personIndex, weekNum) {
            if (personIndex === undefined || weekNum === undefined) {
                showMessage('ì‚­ì œ ì˜¤ë¥˜: ì˜ëª»ëœ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            const person = people[personIndex];
            if (!person) {
                showMessage('ì‚­ì œ ì˜¤ë¥˜: ì¸ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            if (confirm(`${person.name}ì˜ ${weekNum}ì£¼ì°¨ ì œì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                delete person.weeklyRestrictions[weekNum];
                renderPersonList();
                showMessage('ì£¼ë³„ ì œì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // Add vacation
        function addVacation(personIndex) {
            const startInput = document.getElementById(`vacStart_${personIndex}`);
            const endInput = document.getElementById(`vacEnd_${personIndex}`);

            const start = parseInt(startInput.value);
            const end = parseInt(endInput.value);

            if (!start || !end) {
                showMessage('íœ´ê°€ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (start < 1 || start > 20 || end < 1 || end > 20) {
                showMessage('DayëŠ” 1ë¶€í„° 20 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            if (start > end) {
                showMessage('ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            people[personIndex].addVacation(start, end);
            renderPersonList();
            showMessage(`${people[personIndex].name}ì˜ íœ´ê°€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (Day ${start} ~ ${end})`, 'success');
        }

        // Remove vacation
        function removeVacation(personIndex, vacationIndex) {
            if (personIndex === undefined || vacationIndex === undefined) {
                showMessage('ì‚­ì œ ì˜¤ë¥˜: ì˜ëª»ëœ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            const person = people[personIndex];
            if (!person) {
                showMessage('ì‚­ì œ ì˜¤ë¥˜: ì¸ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const vacation = person.vacations[vacationIndex];
            if (!vacation) {
                showMessage('ì‚­ì œ ì˜¤ë¥˜: íœ´ê°€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            if (confirm(`${person.name}ì˜ íœ´ê°€ (Day ${vacation.start} ~ ${vacation.end})ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                person.vacations.splice(vacationIndex, 1);
                renderPersonList();
                showMessage('íœ´ê°€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // Generate schedule
        function generateSchedule() {
            if (people.length === 0) {
                showMessage('ì¸ì›ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (workdaysInMonth.length === 0) {
                showMessage('ë¨¼ì € ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // Reset counts
            people.forEach(p => {
                p.primaryCount = 0;
                p.secondaryCount = 0;
            });

            schedule = [];

            // Try to generate schedule
            let success = true;
            let attempts = 0;
            const maxAttempts = 100;

            while (attempts < maxAttempts) {
                attempts++;
                schedule = [];
                people.forEach(p => {
                    p.primaryCount = 0;
                    p.secondaryCount = 0;
                });

                success = true;

                for (let idx = 0; idx < workdaysInMonth.length; idx++) {
                    const workday = workdaysInMonth[idx];
                    const week = Math.floor(idx / 5);
                    const weekNumber = week + 1;
                    const dayOfWeek = workday.dayOfWeek;
                    const dayNumber = idx + 1;
                    const actualDate = workday.day;
                    const requiredPrimary = workday.primaryCount;
                    const requiredSecondary = workday.secondaryCount;

                    // ë‹¹ì§ì ë°°ì—´ (ì—¬ëŸ¬ ëª…ì¼ ìˆ˜ ìˆìŒ)
                    const primaryAssigned = [];
                    const secondaryAssigned = [];

                    // Primary duty ë°°ì •
                    for (let p = 0; p < requiredPrimary; p++) {
                        const primaryCandidates = people.filter(person =>
                            person.canDoPrimaryDuty(dayOfWeek, dayNumber, weekNumber) &&
                            person.canTakeMoreDuties() &&
                            !isConsecutive(schedule, person.name, idx) &&
                            !primaryAssigned.includes(person.name) &&
                            !secondaryAssigned.includes(person.name)
                        ).sort((a, b) => a.primaryCount - b.primaryCount);

                        if (primaryCandidates.length === 0) {
                            success = false;
                            break;
                        }

                        const selected = primaryCandidates[0];
                        primaryAssigned.push(selected.name);
                        selected.primaryCount++;
                    }

                    if (!success) break;

                    // Secondary duty ë°°ì •
                    for (let s = 0; s < requiredSecondary; s++) {
                        const secondaryCandidates = people.filter(person =>
                            !primaryAssigned.includes(person.name) &&
                            !secondaryAssigned.includes(person.name) &&
                            person.canDoSecondaryDuty(dayOfWeek, dayNumber, weekNumber) &&
                            (person.secondDutyPref === 'preferred' ||
                             (person.secondDutyPref === '2nd-only' && person.canTakeMoreDuties()) ||
                             (person.secondDutyPref === 'limited' && person.secondaryCount < 1) ||
                             (person.secondDutyPref === 'normal' && person.canTakeMoreDuties())) &&
                            !isConsecutive(schedule, person.name, idx)
                        ).sort((a, b) => {
                            if (a.secondDutyPref === 'preferred' && b.secondDutyPref !== 'preferred') return -1;
                            if (b.secondDutyPref === 'preferred' && a.secondDutyPref !== 'preferred') return 1;
                            if (a.secondDutyPref === '2nd-only' && b.secondDutyPref !== '2nd-only' && b.secondDutyPref !== 'preferred') return -1;
                            if (b.secondDutyPref === '2nd-only' && a.secondDutyPref !== '2nd-only' && a.secondDutyPref !== 'preferred') return 1;
                            return a.secondaryCount - b.secondaryCount;
                        });

                        if (secondaryCandidates.length === 0) {
                            success = false;
                            break;
                        }

                        const selected = secondaryCandidates[0];
                        secondaryAssigned.push(selected.name);
                        selected.secondaryCount++;
                    }

                    if (!success) break;

                    schedule.push({
                        day: dayNumber,
                        actualDate: actualDate,
                        week: weekNumber,
                        dayOfWeek: dayOfWeek,
                        primary: primaryAssigned,
                        secondary: secondaryAssigned,
                        month: selectedMonth,
                        year: selectedYear,
                        isHoliday: workday.isHoliday,
                        holidayName: workday.holidayName
                    });
                }

                if (success) break;
            }

            if (!success) {
                showMessage(`ë‹¹ì§í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ì™„í™”í•´ì£¼ì„¸ìš”. (${attempts}ë²ˆ ì‹œë„)`, 'error');
                return;
            }

            showMessage(`${selectedYear}ë…„ ${selectedMonth}ì›” ë‹¹ì§í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (${attempts}ë²ˆ ì‹œë„)`, 'success');
            renderCalendar();
            renderStatistics();
        }

        // Check if assignment would be consecutive
        function isConsecutive(schedule, personName, currentDay) {
            if (currentDay === 0) return false;

            const previousDay = schedule[currentDay - 1];
            if (!previousDay) return false;

            // primaryì™€ secondaryê°€ ë°°ì—´ì¸ ê²½ìš° ì²˜ë¦¬
            const prevPrimary = Array.isArray(previousDay.primary) ? previousDay.primary : [previousDay.primary];
            const prevSecondary = Array.isArray(previousDay.secondary) ? previousDay.secondary : [previousDay.secondary];

            return prevPrimary.includes(personName) || prevSecondary.includes(personName);
        }

        // Current editing day
        let editingDayIndex = null;

        // Render calendar
        function renderCalendar() {
            const calendarDiv = document.getElementById('calendar');
            if (!schedule || schedule.length === 0) {
                calendarDiv.innerHTML = '';
                return;
            }

            // ìº˜ë¦°ë” ì œëª©
            const firstDay = schedule[0];
            let html = `<h3 style="margin-bottom: 15px; color: #2c3e50;">${firstDay.year}ë…„ ${firstDay.month}ì›” ë‹¹ì§í‘œ</h3>`;
            html += '<div class="calendar">';

            schedule.forEach((day, index) => {
                // Check who is on vacation this day
                const vacationers = people.filter(p => p.isOnVacation(day.day))
                    .map(p => p.name);

                let vacationHTML = '';
                if (vacationers.length > 0) {
                    vacationHTML = `<div class="vacation-indicator">ğŸ–ï¸ ${vacationers.join(', ')}</div>`;
                }

                // primaryì™€ secondaryë¥¼ ë°°ì—´ë¡œ ì²˜ë¦¬
                const primaryList = Array.isArray(day.primary) ? day.primary : [day.primary];
                const secondaryList = Array.isArray(day.secondary) ? day.secondary : [day.secondary];

                const isEditing = editingDayIndex === index;
                const editableClass = 'editable';
                const manuallyEditedClass = day.manuallyEdited ? 'manually-edited' : '';
                const editModeClass = isEditing ? 'edit-mode' : '';
                const manualBadge = day.manuallyEdited ? '<div class="manual-edit-badge">ìˆ˜ì •ë¨</div>' : '';

                // íœ´ì¼ í‘œì‹œ
                let holidayBadge = '';
                if (day.isHoliday && day.holidayName) {
                    holidayBadge = `<div style="font-size: 10px; color: #e74c3c; margin-bottom: 5px;">ğŸŒ ${day.holidayName}</div>`;
                }

                let contentHTML = '';
                if (isEditing) {
                    // Edit mode - ì²« ë²ˆì§¸ ë‹¹ì§ìë§Œ í¸ì§‘ ê°€ëŠ¥
                    contentHTML = `
                        <div class="day-header">
                            <span class="day-number">${day.month}/${day.actualDate}</span> ${day.dayOfWeek}ìš”ì¼
                        </div>
                        ${holidayBadge}
                        <div class="edit-controls">
                            <label style="font-size: 12px; margin: 0;">ë‹¹ì§ (Primary)</label>
                            <select id="editPrimary_${index}">
                                ${people.map(p => `<option value="${p.name}" ${primaryList[0] === p.name ? 'selected' : ''}>${p.name}</option>`).join('')}
                            </select>
                            <label style="font-size: 12px; margin: 0;">2nd Duty</label>
                            <select id="editSecondary_${index}">
                                ${people.map(p => `<option value="${p.name}" ${secondaryList[0] === p.name ? 'selected' : ''}>${p.name}</option>`).join('')}
                            </select>
                            <div>
                                <button onclick="saveEdit(${index})" style="background: #27ae60;">ì €ì¥</button>
                                <button onclick="cancelEdit()" class="secondary">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    `;
                } else {
                    // Display mode
                    const primaryDisplay = primaryList.map(name => `ğŸ”´ ${name}`).join('<br>');
                    const secondaryDisplay = secondaryList.map(name => `ğŸ”µ ${name}`).join('<br>');

                    contentHTML = `
                        <div class="day-header">
                            <span class="day-number">${day.month}/${day.actualDate}</span> ${day.dayOfWeek}ìš”ì¼
                            <span style="font-size: 11px; color: #7f8c8d; margin-left: 5px;">(${day.day}ì¼ì°¨)</span>
                        </div>
                        ${holidayBadge}
                        <div class="duty-assignment">
                            <div class="duty-primary">${primaryDisplay}</div>
                            <div class="duty-secondary">${secondaryDisplay}</div>
                        </div>
                        ${vacationHTML}
                    `;
                }

                html += `
                    <div class="calendar-day week${day.week} ${editableClass} ${manuallyEditedClass} ${editModeClass}"
                         onclick="${isEditing ? '' : `editDay(${index})`}">
                        ${manualBadge}
                        ${contentHTML}
                    </div>
                `;
            });
            html += '</div>';
            calendarDiv.innerHTML = html;
        }

        // Edit day
        function editDay(dayIndex) {
            if (editingDayIndex !== null) {
                cancelEdit();
            }
            editingDayIndex = dayIndex;
            renderCalendar();
        }

        // Cancel edit
        function cancelEdit() {
            editingDayIndex = null;
            renderCalendar();
        }

        // Save edit
        function saveEdit(dayIndex) {
            const primarySelect = document.getElementById(`editPrimary_${dayIndex}`);
            const secondarySelect = document.getElementById(`editSecondary_${dayIndex}`);

            const newPrimary = primarySelect.value;
            const newSecondary = secondarySelect.value;

            if (newPrimary === newSecondary) {
                showMessage('ë‹¹ì§ê³¼ 2nd dutyëŠ” ê°™ì€ ì‚¬ëŒì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const day = schedule[dayIndex];

            // Update schedule - ë°°ì—´ì˜ ì²« ë²ˆì§¸ ìš”ì†Œë§Œ ë³€ê²½
            if (Array.isArray(day.primary)) {
                day.primary[0] = newPrimary;
            } else {
                day.primary = [newPrimary];
            }

            if (Array.isArray(day.secondary)) {
                day.secondary[0] = newSecondary;
            } else {
                day.secondary = [newSecondary];
            }

            day.manuallyEdited = true;

            // Recalculate counts
            recalculateCounts();

            editingDayIndex = null;
            renderCalendar();
            renderStatistics();
            showMessage(`${day.month}/${day.actualDate} ë‹¹ì§ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // Recalculate duty counts
        function recalculateCounts() {
            // Reset all counts
            people.forEach(p => {
                p.primaryCount = 0;
                p.secondaryCount = 0;
            });

            // Count from schedule
            schedule.forEach(day => {
                const primaryList = Array.isArray(day.primary) ? day.primary : [day.primary];
                const secondaryList = Array.isArray(day.secondary) ? day.secondary : [day.secondary];

                primaryList.forEach(name => {
                    const person = people.find(p => p.name === name);
                    if (person) person.primaryCount++;
                });

                secondaryList.forEach(name => {
                    const person = people.find(p => p.name === name);
                    if (person) person.secondaryCount++;
                });
            });
        }

        // Render statistics
        function renderStatistics() {
            const statsDiv = document.getElementById('statistics');
            if (!schedule || schedule.length === 0) {
                statsDiv.innerHTML = '';
                return;
            }

            let html = '<div class="stats"><h3>ğŸ“Š í†µê³„</h3><div class="stats-grid">';
            people.forEach(person => {
                const total = person.primaryCount + person.secondaryCount;
                html += `
                    <div class="stat-item">
                        <strong>${person.name}</strong><br>
                        <span class="small-text">
                            ë‹¹ì§: ${person.primaryCount}íšŒ |
                            2nd: ${person.secondaryCount}íšŒ |
                            ì´: ${total}íšŒ
                        </span>
                    </div>
                `;
            });
            html += '</div></div>';
            statsDiv.innerHTML = html;
        }

        // Show message
        function showMessage(msg, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const alertClass = type === 'error' ? 'alert-error' :
                              type === 'success' ? 'alert-success' : 'alert-info';
            messagesDiv.innerHTML = `<div class="alert ${alertClass}">${msg}</div>`;
            setTimeout(() => {
                messagesDiv.innerHTML = '';
            }, 5000);
        }

        // Export schedule
        function exportSchedule() {
            if (!schedule || schedule.length === 0) {
                showMessage('ë¨¼ì € ë‹¹ì§í‘œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const firstDay = schedule[0];
            let text = `ë³‘ì› ë‹¹ì§í‘œ - ${firstDay.year}ë…„ ${firstDay.month}ì›”\n\n`;

            // Schedule
            schedule.forEach(day => {
                const primaryList = Array.isArray(day.primary) ? day.primary : [day.primary];
                const secondaryList = Array.isArray(day.secondary) ? day.secondary : [day.secondary];

                const vacationers = people.filter(p => p.isOnVacation(day.day)).map(p => p.name);
                let vacInfo = vacationers.length > 0 ? ` (íœ´ê°€: ${vacationers.join(', ')})` : '';
                let editInfo = day.manuallyEdited ? ' [ìˆ˜ë™í¸ì§‘]' : '';
                let holidayInfo = day.isHoliday && day.holidayName ? ` [${day.holidayName}]` : '';

                text += `${day.month}/${day.actualDate} ${day.dayOfWeek}ìš”ì¼ (${day.day}ì¼ì°¨)${holidayInfo}: ë‹¹ì§ ${primaryList.join(', ')}, 2nd ${secondaryList.join(', ')}${vacInfo}${editInfo}\n`;
            });

            // Statistics
            text += '\ní†µê³„:\n';
            people.forEach(person => {
                let vacText = '';
                if (person.vacations && person.vacations.length > 0) {
                    const vacList = person.vacations.map(v => `Day ${v.start}-${v.end}`).join(', ');
                    vacText = ` (íœ´ê°€: ${vacList})`;
                }

                let weeklyText = '';
                if (person.weeklyRestrictions && Object.keys(person.weeklyRestrictions).length > 0) {
                    const weeklyList = Object.keys(person.weeklyRestrictions).sort().map(weekNum => {
                        const r = person.weeklyRestrictions[weekNum];
                        const unavail = r.unavailable && r.unavailable.length > 0 ? r.unavailable.join(',') : '';
                        const alt = r.alternative && r.alternative.length > 0 ? `(2nd:${r.alternative.join(',')})` : '';
                        return `${weekNum}ì£¼:${unavail}${alt}`;
                    }).join(', ');
                    weeklyText = ` (ì£¼ë³„ì œì•½: ${weeklyList})`;
                }

                text += `${person.name}: ë‹¹ì§ ${person.primaryCount}íšŒ, 2nd ${person.secondaryCount}íšŒ, ì´ ${person.getTotalDuties()}íšŒ${vacText}${weeklyText}\n`;
            });

            // Manual edits summary
            const manualEdits = schedule.filter(d => d.manuallyEdited);
            if (manualEdits.length > 0) {
                text += '\nìˆ˜ë™ í¸ì§‘ëœ ë‚ ì§œ:\n';
                manualEdits.forEach(day => {
                    text += `- Day ${day.day} (${day.dayOfWeek})\n`;
                });
            }

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ë‹¹ì§í‘œ_${firstDay.year}ë…„${firstDay.month}ì›”.txt`;
            a.click();
            URL.revokeObjectURL(url);

            showMessage('ë‹¹ì§í‘œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Initialize
        initYearSelector();
        renderPersonList();
        showCalendarPreview();
    </script>
</body>
</html>
