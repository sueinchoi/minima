---
layout: default
title: ë³‘ì› ë‹¹ì§í‘œ ìƒì„±ê¸°
---

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            color: #34495e;
            margin-top: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .result-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .person-entry {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .person-entry h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 16px;
        }

        label {
            display: block;
            margin: 8px 0 4px 0;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 5px 0;
        }

        .checkbox-group label {
            display: inline-flex;
            align-items: center;
            margin: 0;
            font-weight: normal;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            margin: 5px;
        }

        button:hover {
            background: #2980b9;
        }

        button.secondary {
            background: #95a5a6;
        }

        button.secondary:hover {
            background: #7f8c8d;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover {
            background: #c0392b;
        }

        .button-group {
            text-align: center;
            margin: 20px 0;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-day {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background: white;
            min-height: 100px;
        }

        .calendar-day.week1 { background: #fff5f5; }
        .calendar-day.week2 { background: #f5f9ff; }
        .calendar-day.week3 { background: #f5fff5; }
        .calendar-day.week4 { background: #fffef5; }

        .day-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e0e0e0;
        }

        .day-number {
            font-size: 18px;
            color: #3498db;
        }

        .duty-assignment {
            margin: 5px 0;
            font-size: 14px;
        }

        .duty-primary {
            color: #e74c3c;
            font-weight: 600;
        }

        .duty-secondary {
            color: #3498db;
            font-weight: 500;
        }

        .stats {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #3498db;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .alert-error {
            background: #fee;
            border-left: 4px solid #e74c3c;
            color: #c0392b;
        }

        .alert-success {
            background: #efe;
            border-left: 4px solid #27ae60;
            color: #229954;
        }

        .alert-info {
            background: #eff;
            border-left: 4px solid #3498db;
            color: #2471a3;
        }

        .small-text {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
        }

        .add-person-form {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .preference-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }

        .badge-2nd-preferred {
            background: #d4edda;
            color: #155724;
        }

        .badge-2nd-limited {
            background: #fff3cd;
            color: #856404;
        }

        .badge-vacation {
            background: #f8d7da;
            color: #721c24;
        }

        .vacation-indicator {
            background: #f8d7da;
            color: #721c24;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            margin-top: 5px;
            font-weight: 600;
        }

        .vacation-form {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 3px solid #ffc107;
        }

        .vacation-list {
            margin-top: 10px;
        }

        .vacation-item {
            background: #fff;
            padding: 5px 10px;
            margin: 5px 0;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .day-range-input {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 5px;
            align-items: center;
        }

        .day-range-input input {
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>ğŸ¥ ë³‘ì› ë‹¹ì§í‘œ ìë™ ìƒì„±ê¸°</h1>

    <div class="container">
        <!-- Input Section -->
        <div class="input-section">
            <h2>ğŸ“‹ ì¸ì› ê´€ë¦¬</h2>

            <div class="add-person-form">
                <h3>ìƒˆ ì¸ì› ì¶”ê°€</h3>
                <label>ì´ë¦„</label>
                <input type="text" id="newPersonName" placeholder="ì´ë¦„ ì…ë ¥">

                <label>ë¶ˆê°€ëŠ¥í•œ ìš”ì¼ (ë‹¹ì§)</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" value="ì›”" class="new-unavailable-day"> ì›”</label>
                    <label><input type="checkbox" value="í™”" class="new-unavailable-day"> í™”</label>
                    <label><input type="checkbox" value="ìˆ˜" class="new-unavailable-day"> ìˆ˜</label>
                    <label><input type="checkbox" value="ëª©" class="new-unavailable-day"> ëª©</label>
                    <label><input type="checkbox" value="ê¸ˆ" class="new-unavailable-day"> ê¸ˆ</label>
                </div>

                <label>ëŒ€ì²´ ê°€ëŠ¥ ìš”ì¼ (2nd dutyë¡œ ê°€ëŠ¥)</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" value="ì›”" class="new-alternative-day"> ì›”</label>
                    <label><input type="checkbox" value="í™”" class="new-alternative-day"> í™”</label>
                    <label><input type="checkbox" value="ìˆ˜" class="new-alternative-day"> ìˆ˜</label>
                    <label><input type="checkbox" value="ëª©" class="new-alternative-day"> ëª©</label>
                    <label><input type="checkbox" value="ê¸ˆ" class="new-alternative-day"> ê¸ˆ</label>
                </div>

                <label>ìµœëŒ€ ë‹¹ì§ íšŸìˆ˜</label>
                <input type="number" id="newPersonMaxDuties" value="5" min="0" max="20">

                <label>2nd Duty ì„ í˜¸ë„</label>
                <select id="newPersonSecondDutyPref">
                    <option value="normal">ì¼ë°˜</option>
                    <option value="preferred">ì„ í˜¸ (ë¬´ì œí•œ)</option>
                    <option value="limited">ì œí•œì  (1íšŒë§Œ)</option>
                </select>

                <div class="button-group">
                    <button onclick="addPerson()">â• ì¸ì› ì¶”ê°€</button>
                </div>
            </div>

            <div id="personList"></div>

            <div class="button-group">
                <button onclick="loadSampleData()">ğŸ“ ì˜ˆì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button onclick="clearAllData()" class="danger">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
            </div>
        </div>

        <!-- Result Section -->
        <div class="result-section">
            <h2>ğŸ“… ë‹¹ì§í‘œ</h2>

            <div class="button-group">
                <button onclick="generateSchedule()">ğŸ¯ ë‹¹ì§í‘œ ìƒì„±</button>
                <button onclick="exportSchedule()" class="secondary">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
            </div>

            <div id="messages"></div>
            <div id="calendar"></div>
            <div id="statistics"></div>
        </div>
    </div>

    <script>
        // Global data
        let people = [];
        let schedule = null;
        const DAYS_OF_WEEK = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
        const TOTAL_DAYS = 20;
        const WEEKS = 4;

        // Person class
        class Person {
            constructor(name, unavailableDays, alternativeDays, maxDuties, secondDutyPref, vacations) {
                this.name = name;
                this.unavailableDays = unavailableDays || [];
                this.alternativeDays = alternativeDays || [];
                this.maxDuties = maxDuties || 5;
                this.secondDutyPref = secondDutyPref || 'normal'; // 'normal', 'preferred', 'limited'
                this.vacations = vacations || []; // Array of {start, end} objects
                this.primaryCount = 0;
                this.secondaryCount = 0;
            }

            isOnVacation(dayNumber) {
                return this.vacations.some(v => dayNumber >= v.start && dayNumber <= v.end);
            }

            canDoPrimaryDuty(dayOfWeek, dayNumber) {
                if (this.isOnVacation(dayNumber)) return false;
                return !this.unavailableDays.includes(dayOfWeek);
            }

            canDoSecondaryDuty(dayOfWeek, dayNumber) {
                if (this.isOnVacation(dayNumber)) return false;
                if (this.unavailableDays.includes(dayOfWeek)) {
                    return this.alternativeDays.includes(dayOfWeek);
                }
                return true;
            }

            getTotalDuties() {
                return this.primaryCount + this.secondaryCount;
            }

            canTakeMoreDuties() {
                if (this.secondDutyPref === 'preferred') {
                    return true; // Unlimited for 2nd duty preferred
                }
                if (this.secondDutyPref === 'limited' && this.secondaryCount >= 1) {
                    return this.primaryCount < this.maxDuties;
                }
                return this.getTotalDuties() < this.maxDuties;
            }

            addVacation(start, end) {
                this.vacations.push({ start, end });
            }

            removeVacation(index) {
                this.vacations.splice(index, 1);
            }
        }

        // Load sample data
        function loadSampleData() {
            people = [
                new Person('ê¹€ë‚˜ì˜', ['í™”', 'ëª©', 'ê¸ˆ'], [], 3, 'normal', []),
                new Person('ì´í˜„ê·œ', [], [], 20, 'preferred', []),
                new Person('ì´ì •ìˆ˜', ['ìˆ˜', 'ëª©'], ['ìˆ˜'], 5, 'normal', []),
                new Person('ìœ ì˜ì² ', ['ìˆ˜', 'ëª©', 'ê¸ˆ'], [], 3, 'normal', []),
                new Person('ì„œì§€ìš°', ['ì›”', 'í™”'], ['ì›”'], 5, 'normal', []),
                new Person('ì´ë¯¼ì •', ['í™”', 'ìˆ˜'], ['í™”'], 5, 'normal', []),
                new Person('ê³µí¬ì •', ['ì›”', 'í™”'], ['ì›”'], 5, 'normal', []),
                new Person('ë¬¸ì§€ì• ', ['ëª©', 'ê¸ˆ'], ['ëª©'], 5, 'normal', []),
                new Person('ì „ë³‘ë‚¨', ['ìˆ˜', 'ëª©'], ['ìˆ˜'], 5, 'normal', []),
                new Person('ë…¸í˜„ì •', ['í™”', 'ìˆ˜'], ['í™”'], 5, 'normal', []),
                new Person('ë°±ì§€ì›', [], [], 5, 'limited', []),
                new Person('ë°•ìˆ˜ì •', ['ê¸ˆ', 'ì›”'], ['ê¸ˆ'], 5, 'normal', [{start: 5, end: 12}])
            ];
            renderPersonList();
            showMessage('ì˜ˆì‹œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. (ë°•ìˆ˜ì •: Day 5-12 íœ´ê°€)', 'success');
        }

        // Add person
        function addPerson() {
            const name = document.getElementById('newPersonName').value.trim();
            if (!name) {
                showMessage('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const unavailableDays = Array.from(document.querySelectorAll('.new-unavailable-day:checked'))
                .map(cb => cb.value);
            const alternativeDays = Array.from(document.querySelectorAll('.new-alternative-day:checked'))
                .map(cb => cb.value);
            const maxDuties = parseInt(document.getElementById('newPersonMaxDuties').value) || 5;
            const secondDutyPref = document.getElementById('newPersonSecondDutyPref').value;

            people.push(new Person(name, unavailableDays, alternativeDays, maxDuties, secondDutyPref));

            // Clear form
            document.getElementById('newPersonName').value = '';
            document.querySelectorAll('.new-unavailable-day').forEach(cb => cb.checked = false);
            document.querySelectorAll('.new-alternative-day').forEach(cb => cb.checked = false);
            document.getElementById('newPersonMaxDuties').value = 5;
            document.getElementById('newPersonSecondDutyPref').value = 'normal';

            renderPersonList();
            showMessage(`${name} ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // Remove person
        function removePerson(index) {
            const person = people[index];
            if (confirm(`${person.name} ë‹˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                people.splice(index, 1);
                renderPersonList();
                showMessage('ì¸ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('ëª¨ë“  ì¸ì› ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                people = [];
                schedule = null;
                renderPersonList();
                document.getElementById('calendar').innerHTML = '';
                document.getElementById('statistics').innerHTML = '';
                showMessage('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // Render person list
        function renderPersonList() {
            const listDiv = document.getElementById('personList');
            if (people.length === 0) {
                listDiv.innerHTML = '<p class="small-text">ë“±ë¡ëœ ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¸ì›ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì˜ˆì‹œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</p>';
                return;
            }

            let html = '<h3>ë“±ë¡ëœ ì¸ì› (' + people.length + 'ëª…)</h3>';
            people.forEach((person, index) => {
                let badge = '';
                if (person.secondDutyPref === 'preferred') {
                    badge = '<span class="preference-badge badge-2nd-preferred">2nd ì„ í˜¸</span>';
                } else if (person.secondDutyPref === 'limited') {
                    badge = '<span class="preference-badge badge-2nd-limited">2nd 1íšŒë§Œ</span>';
                }

                let vacationHTML = '';
                if (person.vacations && person.vacations.length > 0) {
                    vacationHTML = '<div class="vacation-list">';
                    person.vacations.forEach((vacation, vIdx) => {
                        vacationHTML += `
                            <div class="vacation-item">
                                <span>ğŸ–ï¸ Day ${vacation.start} ~ ${vacation.end}</span>
                                <button onclick="removeVacation(${index}, ${vIdx})" class="danger" style="padding: 3px 8px; font-size: 12px;">ì‚­ì œ</button>
                            </div>
                        `;
                    });
                    vacationHTML += '</div>';
                }

                html += `
                    <div class="person-entry">
                        <h3>${person.name}${badge}</h3>
                        <p class="small-text">
                            <strong>ë‹¹ì§ ë¶ˆê°€:</strong> ${person.unavailableDays.join(', ') || 'ì—†ìŒ'}<br>
                            <strong>2nd ê°€ëŠ¥:</strong> ${person.alternativeDays.join(', ') || 'í•´ë‹¹ì—†ìŒ'}<br>
                            <strong>ìµœëŒ€ íšŸìˆ˜:</strong> ${person.maxDuties}íšŒ
                        </p>
                        ${vacationHTML}
                        <div class="vacation-form">
                            <label style="font-size: 13px; margin-bottom: 5px;">íœ´ê°€ ì¶”ê°€</label>
                            <div class="day-range-input">
                                <input type="number" id="vacStart_${index}" min="1" max="20" placeholder="ì‹œì‘ì¼">
                                <span>~</span>
                                <input type="number" id="vacEnd_${index}" min="1" max="20" placeholder="ì¢…ë£Œì¼">
                            </div>
                            <button onclick="addVacation(${index})" style="padding: 6px 12px; font-size: 13px; margin-top: 5px;">íœ´ê°€ ì¶”ê°€</button>
                        </div>
                        <button onclick="removePerson(${index})" class="danger" style="padding: 6px 12px; font-size: 14px; margin-top: 10px;">ì¸ì› ì‚­ì œ</button>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
        }

        // Add vacation
        function addVacation(personIndex) {
            const startInput = document.getElementById(`vacStart_${personIndex}`);
            const endInput = document.getElementById(`vacEnd_${personIndex}`);

            const start = parseInt(startInput.value);
            const end = parseInt(endInput.value);

            if (!start || !end) {
                showMessage('íœ´ê°€ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (start < 1 || start > 20 || end < 1 || end > 20) {
                showMessage('DayëŠ” 1ë¶€í„° 20 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            if (start > end) {
                showMessage('ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            people[personIndex].addVacation(start, end);
            renderPersonList();
            showMessage(`${people[personIndex].name}ì˜ íœ´ê°€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (Day ${start} ~ ${end})`, 'success');
        }

        // Remove vacation
        function removeVacation(personIndex, vacationIndex) {
            const person = people[personIndex];
            const vacation = person.vacations[vacationIndex];
            if (confirm(`${person.name}ì˜ íœ´ê°€ (Day ${vacation.start} ~ ${vacation.end})ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                person.removeVacation(vacationIndex);
                renderPersonList();
                showMessage('íœ´ê°€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        // Generate schedule
        function generateSchedule() {
            if (people.length === 0) {
                showMessage('ì¸ì›ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // Reset counts
            people.forEach(p => {
                p.primaryCount = 0;
                p.secondaryCount = 0;
            });

            schedule = [];
            const assignments = [];

            // Try to generate schedule
            let success = true;
            let attempts = 0;
            const maxAttempts = 100;

            while (attempts < maxAttempts) {
                attempts++;
                schedule = [];
                people.forEach(p => {
                    p.primaryCount = 0;
                    p.secondaryCount = 0;
                });

                success = true;

                for (let day = 0; day < TOTAL_DAYS; day++) {
                    const week = Math.floor(day / 5);
                    const dayOfWeek = DAYS_OF_WEEK[day % 5];
                    const dayNumber = day + 1;

                    // Find primary duty
                    const primaryCandidates = people.filter(p =>
                        p.canDoPrimaryDuty(dayOfWeek, dayNumber) &&
                        p.canTakeMoreDuties() &&
                        !isConsecutive(schedule, p.name, day)
                    ).sort((a, b) => a.primaryCount - b.primaryCount);

                    if (primaryCandidates.length === 0) {
                        success = false;
                        break;
                    }

                    const primary = primaryCandidates[0];

                    // Find secondary duty
                    const secondaryCandidates = people.filter(p =>
                        p !== primary &&
                        p.canDoSecondaryDuty(dayOfWeek, dayNumber) &&
                        (p.secondDutyPref === 'preferred' ||
                         (p.secondDutyPref === 'limited' && p.secondaryCount < 1) ||
                         (p.secondDutyPref === 'normal' && p.canTakeMoreDuties())) &&
                        !isConsecutive(schedule, p.name, day)
                    ).sort((a, b) => {
                        // Prefer people who prefer 2nd duty
                        if (a.secondDutyPref === 'preferred' && b.secondDutyPref !== 'preferred') return -1;
                        if (b.secondDutyPref === 'preferred' && a.secondDutyPref !== 'preferred') return 1;
                        return a.secondaryCount - b.secondaryCount;
                    });

                    if (secondaryCandidates.length === 0) {
                        success = false;
                        break;
                    }

                    const secondary = secondaryCandidates[0];

                    schedule.push({
                        day: dayNumber,
                        week: week + 1,
                        dayOfWeek: dayOfWeek,
                        primary: primary.name,
                        secondary: secondary.name
                    });

                    primary.primaryCount++;
                    secondary.secondaryCount++;
                }

                if (success) break;
            }

            if (!success) {
                showMessage(`ë‹¹ì§í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ì™„í™”í•´ì£¼ì„¸ìš”. (${attempts}ë²ˆ ì‹œë„)`, 'error');
                return;
            }

            showMessage(`ë‹¹ì§í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (${attempts}ë²ˆ ì‹œë„)`, 'success');
            renderCalendar();
            renderStatistics();
        }

        // Check if assignment would be consecutive
        function isConsecutive(schedule, personName, currentDay) {
            if (currentDay === 0) return false;

            const previousDay = schedule[currentDay - 1];
            if (!previousDay) return false;

            return previousDay.primary === personName || previousDay.secondary === personName;
        }

        // Render calendar
        function renderCalendar() {
            const calendarDiv = document.getElementById('calendar');
            if (!schedule || schedule.length === 0) {
                calendarDiv.innerHTML = '';
                return;
            }

            let html = '<div class="calendar">';
            schedule.forEach(day => {
                // Check who is on vacation this day
                const vacationers = people.filter(p => p.isOnVacation(day.day))
                    .map(p => p.name);

                let vacationHTML = '';
                if (vacationers.length > 0) {
                    vacationHTML = `<div class="vacation-indicator">ğŸ–ï¸ ${vacationers.join(', ')}</div>`;
                }

                html += `
                    <div class="calendar-day week${day.week}">
                        <div class="day-header">
                            <span class="day-number">Day ${day.day}</span> ${day.dayOfWeek}ìš”ì¼
                        </div>
                        <div class="duty-assignment">
                            <div class="duty-primary">ğŸ”´ ${day.primary}</div>
                            <div class="duty-secondary">ğŸ”µ ${day.secondary}</div>
                        </div>
                        ${vacationHTML}
                    </div>
                `;
            });
            html += '</div>';
            calendarDiv.innerHTML = html;
        }

        // Render statistics
        function renderStatistics() {
            const statsDiv = document.getElementById('statistics');
            if (!schedule || schedule.length === 0) {
                statsDiv.innerHTML = '';
                return;
            }

            let html = '<div class="stats"><h3>ğŸ“Š í†µê³„</h3><div class="stats-grid">';
            people.forEach(person => {
                const total = person.primaryCount + person.secondaryCount;
                html += `
                    <div class="stat-item">
                        <strong>${person.name}</strong><br>
                        <span class="small-text">
                            ë‹¹ì§: ${person.primaryCount}íšŒ |
                            2nd: ${person.secondaryCount}íšŒ |
                            ì´: ${total}íšŒ
                        </span>
                    </div>
                `;
            });
            html += '</div></div>';
            statsDiv.innerHTML = html;
        }

        // Show message
        function showMessage(msg, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const alertClass = type === 'error' ? 'alert-error' :
                              type === 'success' ? 'alert-success' : 'alert-info';
            messagesDiv.innerHTML = `<div class="alert ${alertClass}">${msg}</div>`;
            setTimeout(() => {
                messagesDiv.innerHTML = '';
            }, 5000);
        }

        // Export schedule
        function exportSchedule() {
            if (!schedule || schedule.length === 0) {
                showMessage('ë¨¼ì € ë‹¹ì§í‘œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            let text = 'ë³‘ì› ë‹¹ì§í‘œ\n\n';

            // Schedule
            schedule.forEach(day => {
                const vacationers = people.filter(p => p.isOnVacation(day.day)).map(p => p.name);
                let vacInfo = vacationers.length > 0 ? ` (íœ´ê°€: ${vacationers.join(', ')})` : '';
                text += `Day ${day.day} (${day.dayOfWeek}): ë‹¹ì§ ${day.primary}, 2nd ${day.secondary}${vacInfo}\n`;
            });

            // Statistics
            text += '\ní†µê³„:\n';
            people.forEach(person => {
                let vacText = '';
                if (person.vacations && person.vacations.length > 0) {
                    const vacList = person.vacations.map(v => `Day ${v.start}-${v.end}`).join(', ');
                    vacText = ` (íœ´ê°€: ${vacList})`;
                }
                text += `${person.name}: ë‹¹ì§ ${person.primaryCount}íšŒ, 2nd ${person.secondaryCount}íšŒ, ì´ ${person.getTotalDuties()}íšŒ${vacText}\n`;
            });

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ë‹¹ì§í‘œ_' + new Date().toISOString().slice(0, 10) + '.txt';
            a.click();
            URL.revokeObjectURL(url);

            showMessage('ë‹¹ì§í‘œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Initialize
        renderPersonList();
    </script>
</body>
</html>
