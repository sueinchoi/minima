<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Event Listener Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { margin: 5px; padding: 8px 15px; cursor: pointer; }
        .danger { background: #e74c3c; color: white; border: none; border-radius: 4px; }
        .person-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Event Listener 삭제 버튼 테스트</h1>

    <button onclick="addPerson()">인원 추가</button>
    <div id="personList"></div>

    <script>
        let people = [];

        function addPerson() {
            const name = prompt('이름을 입력하세요:');
            if (!name) return;

            people.push({
                name: name,
                vacations: [
                    {start: 5, end: 10},
                    {start: 15, end: 17}
                ]
            });
            renderList();
        }

        function removePerson(index) {
            console.log('removePerson called:', index);
            if (confirm(people[index].name + ' 님을 삭제하시겠습니까?')) {
                people.splice(index, 1);
                renderList();
                alert('삭제되었습니다');
            }
        }

        function removeVacation(personIndex, vacIndex) {
            console.log('removeVacation called:', personIndex, vacIndex);
            if (confirm('이 휴가를 삭제하시겠습니까?')) {
                people[personIndex].vacations.splice(vacIndex, 1);
                renderList();
                alert('휴가가 삭제되었습니다');
            }
        }

        function renderList() {
            const listDiv = document.getElementById('personList');

            if (people.length === 0) {
                listDiv.innerHTML = '<p>등록된 인원이 없습니다.</p>';
                return;
            }

            let html = '<h2>등록된 인원 (' + people.length + '명)</h2>';

            people.forEach((person, index) => {
                html += '<div class="person-card">';
                html += '<h3>' + person.name + '</h3>';

                // Vacations
                if (person.vacations.length > 0) {
                    html += '<div><strong>휴가:</strong></div>';
                    person.vacations.forEach((vac, vIdx) => {
                        html += '<div>';
                        html += 'Day ' + vac.start + ' ~ ' + vac.end + ' ';
                        html += '<button class="danger btn-delete-vacation" data-person-index="' + index + '" data-vacation-index="' + vIdx + '">삭제</button>';
                        html += '</div>';
                    });
                }

                html += '<br><button class="danger btn-delete-person" data-person-index="' + index + '">인원 삭제</button>';
                html += '</div>';
            });

            listDiv.innerHTML = html;

            // Add event listeners AFTER innerHTML is set
            console.log('Attaching event listeners...');

            document.querySelectorAll('.btn-delete-vacation').forEach(btn => {
                btn.addEventListener('click', function() {
                    const personIndex = parseInt(this.getAttribute('data-person-index'));
                    const vacationIndex = parseInt(this.getAttribute('data-vacation-index'));
                    console.log('Vacation delete button clicked:', personIndex, vacationIndex);
                    removeVacation(personIndex, vacationIndex);
                });
            });

            document.querySelectorAll('.btn-delete-person').forEach(btn => {
                btn.addEventListener('click', function() {
                    const personIndex = parseInt(this.getAttribute('data-person-index'));
                    console.log('Person delete button clicked:', personIndex);
                    removePerson(personIndex);
                });
            });

            console.log('Event listeners attached:',
                document.querySelectorAll('.btn-delete-vacation').length, 'vacation buttons,',
                document.querySelectorAll('.btn-delete-person').length, 'person buttons');
        }

        // Initialize
        renderList();

        // Add test data
        people = [
            { name: '김나영', vacations: [{start: 5, end: 10}, {start: 15, end: 17}] },
            { name: '이현규', vacations: [{start: 1, end: 3}] }
        ];
        renderList();

        console.log('페이지 로드 완료 - 이벤트 리스너 방식');
    </script>
</body>
</html>
